<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Garbage Collection Payment</title>
    <link rel="stylesheet" href="/payment.css">
</head>
<body>
<div class="payment-container">
    <h2>Make a Payment</h2>
    <form id="paymentForm">
        <div class="form-group">
            <label for="amount">Amount:</label>
            <input type="number" id="amount" name="amount" step="0.01" min="0" required>
        </div>

        <div class="form-group">
            <label for="method">Payment Method:</label>
            <select id="method" name="method" required>
                <option value="Credit Card">Credit Card</option>
                <option value="Mobile Money">Mobile Money</option>
                <option value="Bank Transfer">Bank Transfer</option>
                <option value="Cash">Cash</option>
            </select>
        </div>

        <div class="form-actions">
            <button type="button" id="makePaymentButton">Submit Payment</button>
        </div>
    </form>

    <div id="paymentMessage" class="message"></div>
</div>

<div class="payment-history-container">
    <h2>Payment History</h2>
    <table id="paymentHistoryTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>Amount</th>
            <th>Method</th>
            <th>Status</th>
            <th>Date</th>
        </tr>
        </thead>
        <tbody>
        <!-- Payment history populated dynamically -->
        </tbody>
    </table>
</div>

<script>
    document.addEventListener("DOMContentLoaded", async function() {
        // Fetch payment history
        try {
            const paymentResponse = await fetch('/api/payments');
            if (paymentResponse.ok) {
                const payments = await paymentResponse.json();
                const tableBody = document.getElementById("paymentHistoryTable").querySelector("tbody");
                payments.forEach(payment => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${payment.id}</td>
                        <td>${payment.amount.toFixed(2)}</td>
                        <td>${payment.method}</td>
                        <td>${payment.status}</td>
                        <td>${new Date(payment.paymentDate).toLocaleString()}</td>
                    `;
                    tableBody.appendChild(row);
                });
            } else {
                document.getElementById("paymentMessage").innerText = "Could not load payment history.";
            }
        } catch (error) {
            document.getElementById("paymentMessage").innerText = "Error loading payment history.";
        }
    });

    // Make a payment
    document.getElementById("makePaymentButton").addEventListener("click", async function() {
        const amount = document.getElementById("amount").value;
        const method = document.getElementById("method").value;

        const paymentData = { amount, method };

        try {
            const response = await fetch('/api/payments', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(paymentData),
                credentials: 'include'
            });

            if (response.ok) {
                document.getElementById("paymentMessage").innerText = "Payment submitted successfully!";
                // Optionally refresh payment history or reset form
            } else {
                document.getElementById("paymentMessage").innerText = "Failed to submit payment.";
            }
        } catch (error) {
            document.getElementById("paymentMessage").innerText = "Error submitting payment.";
        }
    });
</script>
</body>
</html>
