<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Manage Schedules</title>
    <link rel="stylesheet" href="/static/schedules.css">
</head>
<body>
<div class="container">
    <h2>Manage Schedules</h2>
    <button id="addScheduleButton">Add New Schedule</button>
    <table id="schedulesTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>Route</th>
            <th>Day of the Week</th>
            <th>Collection Time</th>
            <th>Frequency</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <!-- Schedule rows will be populated here -->
        </tbody>
    </table>

    <div id="message" class="message"></div>
</div>

<!-- Add Schedule Modal -->
<div id="addScheduleModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Add New Schedule</h2>
        <form id="addScheduleForm">
            <label for="route">Route:</label>
            <select id="route" name="route" required></select>

            <label for="dayOfWeek">Day of the Week:</label>
            <select id="dayOfWeek" name="dayOfWeek" required>
                <option value="MONDAY">Monday</option>
                <option value="TUESDAY">Tuesday</option>
                <option value="WEDNESDAY">Wednesday</option>
                <option value="THURSDAY">Thursday</option>
                <option value="FRIDAY">Friday</option>
                <option value="SATURDAY">Saturday</option>
                <option value="SUNDAY">Sunday</option>
            </select>

            <label for="collectionTime">Collection Time:</label>
            <input type="time" id="collectionTime" name="collectionTime" required>

            <div class="form-group">
                <label for="frequency">Frequency</label>
                <input type="text" id="frequency" name="frequency" placeholder="e.g., Weekly, Bi-Weekly" required>
            </div>

            <button type="submit">Add Schedule</button>
        </form>
    </div>
</div>

<script src="/static/jquery.js"></script>
<script>
    $(document).ready(function () {
        // Fetch schedules on page load
        fetchSchedules();
        fetchRoutes(); // Fetch routes for the dropdown

        function fetchSchedules() {
            $.ajax({
                url: '/api/schedules', // Adjust to your API endpoint for schedules
                method: 'GET',
                success: function (data) {
                    const tableBody = $('#schedulesTable tbody');
                    tableBody.empty(); // Clear existing rows

                    data.forEach(function (schedule) {
                        const row = `
                            <tr>
                                <td>${schedule.id}</td>
                                <td>${schedule.route.routeName}</td>
                                <td>${schedule.dayOfWeek}</td>
                                <td>${schedule.collectionTime}</td>
                                <td>${schedule.frequency}</td>
                                <td>
                                    <button class="edit-button" data-id="${schedule.id}">Edit</button>
                                    <button class="delete-button" data-id="${schedule.id}">Delete</button>
                                </td>
                            </tr>
                        `;
                        tableBody.append(row);
                    });

                    // Attach event listeners for edit and delete buttons
                    attachEventListeners();
                }
            });
        }

        function fetchRoutes() {
            $.ajax({
                url: '/api/routes', // Adjust to your API endpoint for routes
                method: 'GET',
                success: function (data) {
                    const routeSelect = $('#route');
                    data.forEach(function (route) {
                        const option = `<option value="${route.id}">${route.routeName}</option>`;
                        routeSelect.append(option);
                    });
                }
            });
        }

        function attachEventListeners() {
            $('.edit-button').click(function () {
                const scheduleId = $(this).data('id');
                // Redirect to edit page or open a modal for editing (implement as needed)
                window.location.href = `/edit-schedule/${scheduleId}`; // Adjust to your edit route
            });

            $('.delete-button').click(function () {
                const scheduleId = $(this).data('id');
                if (confirm('Are you sure you want to delete this schedule?')) {
                    $.ajax({
                        url: `/api/schedules/${scheduleId}`, // Adjust to your delete endpoint
                        method: 'DELETE',
                        success: function () {
                            $('#message').text('Schedule deleted successfully!').css('color', 'green');
                            fetchSchedules(); // Refresh the schedule table
                        },
                        error: function () {
                            $('#message').text('Error deleting schedule!').css('color', 'red');
                        }
                    });
                }
            });
        }

        // Add new schedule
        $('#addScheduleForm').on('submit', function (event) {
            event.preventDefault();
            const scheduleData = {
                route: { id: $('#route').val() },
                dayOfWeek: $('#dayOfWeek').val(),
                collectionTime: $('#collectionTime').val(),
                frequency: $('#frequency').val()
            };

            $.ajax({
                url: '/api/schedules', // Adjust to your add schedule endpoint
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(scheduleData),
                success: function () {
                    $('#message').text('Schedule added successfully!').css('color', 'green');
                    fetchSchedules(); // Refresh the schedule table
                    $('#addScheduleModal').hide(); // Close the modal
                },
                error: function () {
                    $('#message').text('Error adding schedule!').css('color', 'red');
                }
            });
        });

        // Show add schedule modal
        $('#addScheduleButton').click(function () {
            $('#addScheduleModal').show();
        });

        // Close modal
        $('.close').click(function () {
            $('#addScheduleModal').hide();
        });
    });
</script>

</body>
</html>