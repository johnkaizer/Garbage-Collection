<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Send Bulk SMS</title>
    <link rel="stylesheet" href="/static/bulk_sms.css">
</head>
<body>
<div class="bulk-sms-container">
    <h2>Send Bulk SMS Notifications</h2>
    <form id="bulkSmsForm">
        <label for="recipientType">Select Recipient Type:</label>
        <select id="recipientType" name="recipientType">
            <option value="all">All Users</option>
            <option value="role">Specific Role</option>
            <option value="individual">Individual User</option>
        </select>

        <div id="roleSelect" style="display: none;">
            <label for="role">Select Role:</label>
            <select id="role" name="role">
                <option value="ADMIN">Admin</option>
                <option value="USER">User</option>
                <option value="DRIVER">Driver</option>
            </select>
        </div>

        <div id="individualSelect" style="display: none;">
            <label for="individualPhone">User Phone Number:</label>
            <input type="text" id="individualPhone" name="phone" placeholder="Enter phone number">
        </div>

        <label for="message">Message:</label>
        <textarea id="message" name="message" rows="4" placeholder="Enter your message here..."></textarea>

        <button type="submit">Send SMS</button>
    </form>
</div>

<script>
    $(document).ready(function () {
        $('#recipientType').on('change', function () {
            const recipientType = $(this).val();
            $('#roleSelect').toggle(recipientType === 'role');
            $('#individualSelect').toggle(recipientType === 'individual');
        });

        $('#bulkSmsForm').on('submit', async function (e) {
            e.preventDefault();
            const recipientType = $('#recipientType').val();
            const message = $('#message').val();
            let url = '/api/sms/send';

            let requestData = { message };

            if (recipientType === 'role') {
                requestData.role = $('#role').val();
                url += '/role';
            } else if (recipientType === 'individual') {
                requestData.phone = $('#individualPhone').val();
                url += '/individual';
            }

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                if (response.ok) {
                    alert('SMS sent successfully');
                } else {
                    alert('Failed to send SMS');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while sending SMS.');
            }
        });
    });
</script>
</body>
</html>
