<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Manage Routes - Admin</title>
    <link rel="stylesheet" href="/static/routes.css">
    <script src="/static/jquery.js"></script>
</head>
<body>
<div class="container">
    <h2>Manage Routes</h2>

    <form id="routeForm">
        <div class="form-group">
            <label for="routeName">Route Name:</label>
            <input type="text" id="routeName" name="routeName" required>
        </div>

        <div class="form-group">
            <label for="landmarks">Landmarks:</label>
            <input type="text" id="landmarks" name="landmarks" required>
        </div>

        <div class="form-group">
            <label for="scheduledDay">Scheduled Day:</label>
            <input type="text" id="scheduledDay" name="scheduledDay" required>
        </div>

        <div class="form-group">
            <label for="driver">Select Driver:</label>
            <select id="driver" name="driver" required>
                <!-- Options will be populated dynamically -->
            </select>
        </div>

        <button type="submit">Add Route</button>
    </form>

    <h3>Existing Routes</h3>
    <table id="routesTable">
        <thead>
        <tr>
            <th>Route Name</th>
            <th>Landmarks</th>
            <th>Scheduled Day</th>
            <th>Driver</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <!-- Existing routes will be populated here -->
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function () {
        // Function to load existing routes
        function loadRoutes() {
            $.ajax({
                url: '/api/routes',
                method: 'GET',
                success: function (data) {
                    const tbody = $('#routesTable tbody');
                    tbody.empty();
                    data.forEach(route => {
                        tbody.append(`
                        <tr>
                            <td>${route.routeName}</td>
                            <td>${route.landmarks}</td>
                            <td>${route.scheduledDay}</td>
                            <td>${route.driver.name}</td>
                            <td>
                                <button class="delete-route" data-id="${route.id}">Delete</button>
                            </td>
                        </tr>
                    `);
                    });
                }
            });
        }

        // Load drivers for the dropdown
        function loadDrivers() {
            $.ajax({
                url: '/api/users/role/DRIVER',
                method: 'GET',
                success: function (data) {
                    const driverSelect = $('#driver');
                    driverSelect.empty();
                    data.forEach(driver => {
                        driverSelect.append(`<option value="${driver.id}">${driver.name}</option>`);
                    });
                }
            });
        }

        // Handle form submission for adding routes
        $('#routeForm').on('submit', function (event) {
            event.preventDefault();
            const formData = $(this).serialize();
            $.ajax({
                url: '/api/routes',
                method: 'POST',
                data: formData,
                success: function () {
                    loadRoutes();
                    $('#routeForm')[0].reset(); // Reset the form
                }
            });
        });

        // Handle delete route action
        $(document).on('click', '.delete-route', function () {
            const routeId = $(this).data('id');
            $.ajax({
                url: `/api/routes/${routeId}`,
                method: 'DELETE',
                success: function () {
                    loadRoutes();
                }
            });
        });

        // Initial load
        loadDrivers();
        loadRoutes();
    });
</script>
</body>
</html>
