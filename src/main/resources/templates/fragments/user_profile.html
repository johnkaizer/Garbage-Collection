<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Profile</title>
    <link rel="stylesheet" href="/static/profile.css">
</head>
<body>
<div class="profile-container">
    <h2>User Profile</h2>
    <form id="profileForm">
        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" required>
        </div>

        <div class="form-group">
            <label for="email">Email (read-only)</label>
            <input type="email" id="email" name="email" required readonly>
        </div>

        <div class="form-group">
            <label for="phone">Phone</label>
            <input type="text" id="phone" name="phone">
        </div>

        <div class="form-group">
            <label for="address">Address</label>
            <input type="text" id="address" name="address">
        </div>

        <div class="form-actions">
            <button type="button" id="saveProfileButton">Save Changes</button>
        </div>
    </form>

    <div id="message" class="message"></div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", async function() {
        try {
            const response = await fetch('/api/users/profile', { method: 'GET', credentials: 'include' });
            if (response.ok) {
                const userData = await response.json();
                document.getElementById("name").value = userData.name;
                document.getElementById("email").value = userData.email;
                document.getElementById("phone").value = userData.phone; // Added phone field
                document.getElementById("address").value = userData.address;
            } else {
                document.getElementById("message").innerText = "Could not load profile details.";
            }
        } catch (error) {
            document.getElementById("message").innerText = "Error loading profile details.";
        }
    });

    document.getElementById("saveProfileButton").addEventListener("click", async function() {
        const updatedData = {
            name: document.getElementById("name").value,
            phone: document.getElementById("phone").value, // Added phone to update data
            address: document.getElementById("address").value,
        };

        try {
            const response = await fetch('/api/users/profile', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updatedData),
                credentials: 'include'
            });

            if (response.ok) {
                document.getElementById("message").innerText = "Profile updated successfully!";
            } else {
                document.getElementById("message").innerText = "Failed to update profile.";
            }
        } catch (error) {
            document.getElementById("message").innerText = "Error updating profile.";
        }
    });
</script>
</body>
</html>
