<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Settings</title>
    <link rel="stylesheet" href="/static/settings.css">
</head>
<body>
<div class="settings-container">
    <h2>User Settings</h2>
    <form id="settingsForm">
        <div class="form-group">
            <label for="smsNotifications">SMS Notifications</label>
            <div class="toggle-switch">
                <input type="checkbox" id="smsNotifications" name="smsNotifications">
                <span class="toggle-slider"></span>
            </div>
        </div>

        <div class="form-group">
            <label for="emailNotifications">Email Notifications</label>
            <div class="toggle-switch">
                <input type="checkbox" id="emailNotifications" name="emailNotifications">
                <span class="toggle-slider"></span>
            </div>
        </div>

        <div class="form-group">
            <label for="appUpdates">App Updates</label>
            <div class="toggle-switch">
                <input type="checkbox" id="appUpdates" name="appUpdates">
                <span class="toggle-slider"></span>
            </div>
        </div>

        <div class="form-group">
            <label for="darkMode">Dark Mode</label>
            <div class="toggle-switch">
                <input type="checkbox" id="darkMode" name="darkMode">
                <span class="toggle-slider"></span>
            </div>
        </div>

        <div class="form-actions">
            <button type="button" id="saveSettingsButton">Save Changes</button>
        </div>
    </form>

    <div id="message" class="message"></div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", async function() {
        try {
            const response = await fetch('/api/users/settings', { method: 'GET', credentials: 'include' });
            if (response.ok) {
                const settingsData = await response.json();
                document.getElementById("smsNotifications").checked = settingsData.smsNotifications;
                document.getElementById("emailNotifications").checked = settingsData.emailNotifications;
                document.getElementById("appUpdates").checked = settingsData.appUpdates;
                document.getElementById("darkMode").checked = settingsData.darkMode;
            } else {
                document.getElementById("message").innerText = "Could not load settings.";
            }
        } catch (error) {
            document.getElementById("message").innerText = "Error loading settings.";
        }
    });

    document.getElementById("saveSettingsButton").addEventListener("click", async function() {
        const updatedSettings = {
            smsNotifications: document.getElementById("smsNotifications").checked,
            emailNotifications: document.getElementById("emailNotifications").checked,
            appUpdates: document.getElementById("appUpdates").checked,
            darkMode: document.getElementById("darkMode").checked,
        };

        try {
            const response = await fetch('/api/users/settings', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updatedSettings),
                credentials: 'include'
            });

            if (response.ok) {
                document.getElementById("message").innerText = "Settings updated successfully!";
            } else {
                document.getElementById("message").innerText = "Failed to update settings.";
            }
        } catch (error) {
            document.getElementById("message").innerText = "Error updating settings.";
        }
    });
</script>

</body>
</html>
